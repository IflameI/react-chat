(this["webpackJsonpchat-clone"]=this["webpackJsonpchat-clone"]||[]).push([[0],{143:function(e,t){},146:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"setCurrentDialog",(function(){return x})),a.d(n,"fetchDialogs",(function(){return g}));var c={};a.r(c),a.d(c,"addMessage",(function(){return S})),a.d(c,"fetchSendMessage",(function(){return N})),a.d(c,"fetchMessages",(function(){return w}));var s={};a.r(s),a.d(s,"setUserData",(function(){return A})),a.d(s,"setIsAuth",(function(){return R})),a.d(s,"fetchUserData",(function(){return C})),a.d(s,"fetchUserLogin",(function(){return D})),a.d(s,"fetchUserRegister",(function(){return y}));var r=a(41),i=a.n(r),l=(a(92),a(1)),o=a(5),d=a(32),u=a(27),j=a(4),h=a(7),m=a.n(h),b=a(12),_=a(21),O=a.n(_);O.a.defaults.baseURL=window.location.origin,O.a.defaults.headers.common.token=window.localStorage.token,window.axios=O.a;var p,v=O.a;!function(e){e.FETCH_DIALOGS_PENDING="FETCH_DIALOGS_PENDING",e.FETCH_DIALOGS_SUCCESS="FETCH_DIALOGS_SUCCESS",e.FETCH_DIALOGS_ERROR="FETCH_DIALOGS_ERROR",e.SET_CURRENT_DIALOG="SET_CURRENT_DIALOG"}(p||(p={}));var f,x=function(e){return{type:p.SET_CURRENT_DIALOG,payload:e}},g=function(){return function(){var e=Object(b.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.get("http://localhost:3000/dialogs");case 3:a=e.sent,t({type:p.FETCH_DIALOGS_SUCCESS,payload:a.data}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t({type:p.FETCH_DIALOGS_ERROR,payload:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()};!function(e){e.FETCH_MESSAGES_PENDING="FETCH_MESSAGES_PENDING",e.FETCH_MESSAGES_SUCCESS="FETCH_MESSAGES_SUCCESS",e.FETCH_MESSAGES_ERROR="FETCH_MESSAGES_ERROR",e.SET_MESSAGE="SET_MESSAGE",e.ADD_MESSAGE="ADD_MESSAGE"}(f||(f={}));var E,S=function(e){return{type:f.ADD_MESSAGE,payload:e}},N=function(e,t){return Object(b.a)(m.a.mark((function a(){return m.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,v.post("http://localhost:3000/messages",{text:e,dialog_id:t});case 2:case"end":return a.stop()}}),a)})))},w=function(e){return function(){var t=Object(b.a)(m.a.mark((function t(a){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a({type:f.FETCH_MESSAGES_PENDING}),t.next=4,v.get("http://localhost:3000/messages?dialog="+e);case 4:n=t.sent,a({type:f.FETCH_MESSAGES_SUCCESS,payload:n.data}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),a({type:f.FETCH_MESSAGES_ERROR});case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()};!function(e){e.SET_USER_DATA_SUCCESS="SET_USER_DATA",e.SET_IS_AUTH="SET_IS_AUTH",e.SET_USER_DATA_PENDING="SET_USER_DATA_PENDING",e.SET_USER_DATA_ERROR="SET_USER_DATA_ERROR"}(E||(E={}));var A=function(e){return{type:E.SET_USER_DATA_SUCCESS,payload:e}},R=function(e){return{type:E.SET_IS_AUTH,payload:e}},C=function(){return function(){var e=Object(b.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.get("http://localhost:3000/user/me");case 3:a=e.sent,t(A(a.data)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),403===e.t0.response.status&&(t({type:E.SET_USER_DATA_ERROR,payload:"\u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),t(R(!1)),delete window.localStorage.token);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},D=function(e){return function(){var t=Object(b.a)(m.a.mark((function t(a){var n,c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v.post("http://localhost:3000/user/signin",e);case 3:return n=t.sent,c=n.data.token,window.axios.defaults.headers.common.token=c,window.localStorage.token=c,a(C()),a(R(!0)),t.abrupt("return",n.data);case 12:t.prev=12,t.t0=t.catch(0),403==t.t0.response.status&&alert("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c");case 16:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}()},y=function(e){return function(){var t=Object(b.a)(m.a.mark((function t(a){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v.post("http://localhost:3000/user/signup",e);case 3:return n=t.sent,t.abrupt("return",n);case 7:t.prev=7,t.t0=t.catch(0),console.log("\u041e\u0448\u0438\u0431\u043a\u0430");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()},T=Object(j.a)(Object(j.a)(Object(j.a)({},n),c),s),k=function(){var e=Object(d.b)();return Object(u.b)(T,e)},G=d.c,M=a(0),U=function(){var e=G((function(e){return e.dialogs})),t=e.currentDialogsId,a=e.items,n=function(e,t,a){var n=e.filter((function(e){return e._id===t}))[0],c={};a&&(n&&n.author._id===a._id?c=n.partner:n&&(c=n.author));return{partner:c}}(a,t,G((function(e){return e.user})).data).partner;return a.length&&t?Object(M.jsx)("header",{className:"header",children:Object(M.jsx)("div",{className:"container",children:Object(M.jsxs)("div",{className:"header__row",children:[Object(M.jsx)("div",{className:"header__logo",children:"Telegram"}),Object(M.jsx)("div",{className:"header__name",children:n.fullname})]})})}):Object(M.jsx)("header",{className:"header",children:Object(M.jsx)("div",{className:"container",children:Object(M.jsx)("div",{className:"header__row",children:Object(M.jsx)("div",{className:"header__logo",children:"react-chat"})})})})},I=function(){return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(U,{}),Object(M.jsx)("div",{className:"main-content",children:Object(M.jsx)("div",{className:"container",children:Object(M.jsxs)("div",{className:"main-content__row",children:[Object(M.jsx)(L,{}),Object(M.jsx)(q,{})]})})})]})},L=function(){var e=G((function(e){return e.dialogs})),t=e.items,a=e.loading,n=e.error,c=e.currentDialogsId,s=k().fetchDialogs;return Object(M.jsx)("div",{className:"main-content__column main-content__column_left main-column-left",children:Object(M.jsx)("div",{className:"main-column-left__wrapper",children:Object(M.jsx)("div",{className:"main-column-left__body",children:Object(M.jsx)(X,{currentDialogsId:c,loading:a,error:n,items:t,fetchDialogs:s})})})})},F=a(26),H=a.n(F),P=a(22),z=function(e){var t=e.lastMessage,a=e.currentDialogsId,n=e.isMe,c=e.author,s=e._id,r=e.partner,i=ve(t.updatedAt).time;return Object(M.jsx)(P.b,{to:"/dialog/".concat(s),children:Object(M.jsxs)("div",{className:H()("main-column-left__item",{"main-column-left__item_active":a===s}),children:[Object(M.jsx)("div",{children:Object(M.jsx)(je,{author:n?r:c})}),Object(M.jsxs)("div",{className:"main-column-left__info",children:[Object(M.jsxs)("div",{className:"main-column-left__top",children:[Object(M.jsx)("div",{className:"main-column-left__name",children:n?r.fullname:c.fullname}),Object(M.jsx)("div",{className:"main-column-left__time",children:i})]}),Object(M.jsxs)("div",{className:"main-column-left__bottom",children:[Object(M.jsx)("div",{className:"main-column-left__text",children:t.text}),Object(M.jsx)("div",{className:"main-column-left__checked",children:Object(M.jsx)(ue,{isMe:n,isRead:t.read})})]})]})]})})},B=a(8),V=a(80),W=a(81),Z=a.n(W)()(window.location.origin.replace("3000","3003")),X=function(e){var t=e.items,a=e.loading,n=e.currentDialogsId,c=e.error,s=e.fetchDialogs,r=G((function(e){return e.user})).data,i=Object(l.useState)(""),o=Object(B.a)(i,2),d=o[0],u=o[1],h=Object(l.useState)(Array.from(t)),m=Object(B.a)(h,2),b=m[0],_=m[1],O=Object(l.useState)(!1),p=Object(B.a)(O,2),v=p[0],f=p[1],x=Object(l.useState)(""),g=Object(B.a)(x,2),E=g[0],S=g[1],N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";_(t.filter((function(t){return t.author.fullname.toLowerCase().indexOf(e.toLowerCase())>=0||t.partner.fullname.toLowerCase().indexOf(e.toLowerCase())>=0}))),u(e)};return window.fetchDialogs=s,Object(l.useEffect)((function(){t.length&&N()}),[t]),Object(l.useEffect)((function(){return s(),Z.on("SERVER:DIALOG_CREATED",s),Z.on("SERVER:NEW_MESSAGE",s),function(){Z.removeListener("SERVER:DIALOG_CREATED",s),Z.removeListener("SERVER:NEW_MESSAGE",s)}}),[]),a?Object(M.jsx)(ie,{}):c?Object(M.jsx)("div",{style:{textAlign:"center"},children:c}):Object(M.jsxs)(M.Fragment,{children:[Object(M.jsxs)("div",{className:"main-column-left__header",children:[Object(M.jsxs)("div",{className:"main-column-left__top top-main-column",children:[Object(M.jsx)("div",{className:"top-main-column__text",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432"}),Object(M.jsx)("div",{className:"top-main-column__icon",children:Object(M.jsx)("button",{onClick:function(){return f(!0)},children:Object(M.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",viewBox:"0 0 24 24",children:Object(M.jsx)("path",{d:"M10 13h-4v-1h4v1zm2.318-4.288l3.301 3.299-4.369.989 1.068-4.288zm11.682-5.062l-7.268 7.353-3.401-3.402 7.267-7.352 3.402 3.401zm-6 8.916v.977c0 4.107-6 2.457-6 2.457s1.518 6-2.638 6h-7.362v-20h14.056l1.977-2h-18.033v24h10.189c3.163 0 9.811-7.223 9.811-9.614v-3.843l-2 2.023z"})})})})]}),Object(M.jsx)("div",{className:"main-column-left__input",children:Object(M.jsx)("input",{value:d,onChange:function(e){return N(e.target.value)},placeholder:"\u041f\u043e\u0438\u0441\u043a"})})]}),Object(M.jsx)(he,{modalActive:v,setModalActive:f,setMessageText:S,messageText:E}),b.length?Object(V.orderBy)(b,["created_at"],["desc"]).map((function(e){return Object(M.jsx)(z,Object(j.a)({currentDialogsId:n,isMe:r&&r._id===e.author.id},e),e._id)})):Object(M.jsx)("div",{className:"main-column-left__unknown",children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"})]})},q=function(){var e=k(),t=e.fetchMessages,a=e.addMessage,n=G((function(e){return e.messages})),c=n.items,s=n.loading,r=n.error,i=G((function(e){return e.dialogs})).currentDialogsId,o=Object(l.useRef)(null),d=function(e){i===e.dialog._id&&a(e)};return Object(l.useEffect)((function(){return i&&t(i),Z.on("SERVER:NEW_MESSAGE",d),function(){Z.removeListener("SERVER:NEW_MESSAGE",d)}}),[i]),Object(l.useEffect)((function(){o.current&&o.current.scrollTo(0,o.current.scrollHeight)})),Object(M.jsx)("div",{className:"main-content__column main-content__column_right",children:Object(M.jsx)("div",{ref:o,className:"main-content__wrapper",children:Object(M.jsx)("div",{className:"main-content__dialogs dialogs-content",children:Object(M.jsx)("div",{className:"dialogs-content__messages-wrapper",children:s?Object(M.jsx)(ie,{}):Object(M.jsx)(K,{currentDialogsId:i,items:c,error:r})})})})})},J=function(e){var t=e.text,a=e.user,n=ve(e.updatedAt).time;return Object(M.jsx)(M.Fragment,{children:Object(M.jsxs)("div",{className:"dialogs-content__message",children:[Object(M.jsxs)("div",{className:"dialogs-content__info",children:[Object(M.jsx)("div",{className:"dialogs-content__img avatar",children:Object(M.jsx)(je,{author:a})}),Object(M.jsx)("div",{className:"dialogs-content__name",children:a.fullname}),Object(M.jsx)("div",{className:"main-column-left__time",children:n})]}),Object(M.jsx)("div",{className:"dialogs-content__main",children:Object(M.jsx)("p",{className:"dialogs-content__text",children:t})})]})})},K=function(e){var t=e.items,a=e.currentDialogsId,n=e.error,c=G((function(e){return e.user})).data;return n?Object(M.jsx)("div",{className:"main-content__void-messages",children:Object(M.jsx)("div",{className:"main-content__text",children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"})}):a?Object(M.jsxs)(M.Fragment,{children:[c&&t.map((function(e,t){return Object(M.jsx)(J,Object(j.a)({isMe:c._id===e.dialog.author,user:e.user},e),"".concat(e.user._id,"_").concat(t))})),Object(M.jsx)(Q,{})]}):Object(M.jsx)("div",{className:"main-content__void-messages",children:Object(M.jsx)("div",{className:"main-content__text",children:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433"})})},Y=a(82),$=a.n(Y),Q=function(){var e=Object(l.useState)(!1),t=Object(B.a)(e,2),a=t[0],n=t[1],c=Object(l.useState)(""),s=Object(B.a)(c,2),r=s[0],i=s[1],o=G((function(e){return e.dialogs})).currentDialogsId,d=k().fetchSendMessage,u=Object(l.useRef)(null),j=function(e){e.preventDefault(),function(e,t){d(e,t)}(r,o),i("")},h=function(e){(e.path||e.composedPath&&e.composedPath()).includes(u.current)||n(!1)};return Object(l.useEffect)((function(){document.body.addEventListener("click",h)}),[]),Object(M.jsx)("div",{className:"dialogs-content__panel",children:Object(M.jsx)("div",{className:"dialogs-content__panel-content",children:Object(M.jsxs)("form",{onSubmit:j,children:[Object(M.jsxs)("div",{className:"dialogs-content__send-message",children:[Object(M.jsx)("textarea",{value:r,onChange:function(e){return i(e.target.value)},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),j(e))}}),Object(M.jsxs)("div",{ref:u,className:"dialogs-content__emoji",children:[Object(M.jsx)("button",{type:"button",onClick:function(){n(!a)},children:Object(M.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:Object(M.jsx)("path",{d:"M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.507 13.941c-1.512 1.195-3.174 1.931-5.506 1.931-2.334 0-3.996-.736-5.508-1.931l-.493.493c1.127 1.72 3.2 3.566 6.001 3.566 2.8 0 4.872-1.846 5.999-3.566l-.493-.493zm-9.007-5.941c-.828 0-1.5.671-1.5 1.5s.672 1.5 1.5 1.5 1.5-.671 1.5-1.5-.672-1.5-1.5-1.5zm7 0c-.828 0-1.5.671-1.5 1.5s.672 1.5 1.5 1.5 1.5-.671 1.5-1.5-.672-1.5-1.5-1.5z"})})}),a&&Object(M.jsx)("div",{className:"dialogs-content__emoji-wrapper",children:Object(M.jsx)($.a,{onEmojiClick:function(e,t){i(r+t.emoji)},disableAutoFocus:!0,groupNames:{smileys_people:"PEOPLE"},native:!0})})]}),Object(M.jsx)("div",{className:"dialogs-content__bottom",children:Object(M.jsx)("div",{className:"dialogs-content__micro",children:Object(M.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"})})})]}),Object(M.jsx)("div",{className:"dialogs-content__button",children:Object(M.jsx)("button",{type:"submit",className:"avatar",children:Object(M.jsx)("img",{src:"https://b.thumbs.redditmedia.com/tjmTLdN1v49BUWeI1q2xtY5mdMG5bV-A2ks1CksPZbA.png",alt:""})})})]})})})},ee=function(e){var t=e.fetchUserLogin,a=e.fetchUserRegister,n=e.history;return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(o.b,{exact:!0,path:"/signin",children:Object(M.jsx)(re,{fetchUserLogin:t,history:n})}),Object(M.jsx)(o.b,{exact:!0,path:"/signup",children:Object(M.jsx)(ce,{fetchUserRegister:a,history:n})}),Object(M.jsx)(o.b,{exact:!0,path:"/signup/verify",children:Object(M.jsx)(oe,{history:n})})]})},te=function(e){var t=e.values,a=e.errors,n=e.touched,c=e.handleChange,s=e.handleBlur,r=e.handleSubmit,i=e.isValid,l=e.isSubmitting;return Object(M.jsx)("div",{className:"auth",children:Object(M.jsx)("div",{className:"container",children:Object(M.jsxs)("div",{className:"auth__row",children:[Object(M.jsxs)("div",{className:"auth__top",children:[Object(M.jsx)("div",{className:"auth__title",children:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"}),Object(M.jsx)("div",{className:"auth__text",children:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"})]}),Object(M.jsx)("form",{onSubmit:r,className:"auth__body",children:Object(M.jsxs)("div",{className:"auth__item",children:[Object(M.jsxs)("div",{className:"auth__functional",children:[Object(M.jsx)("div",{className:"auth__input",children:Object(M.jsx)("input",{id:"email",type:"email",name:"email",onChange:c,onBlur:s,value:t.email,placeholder:"E-mail",className:a.email&&n.email?"text-input error":"text-input"})}),a.email&&n.email&&Object(M.jsx)("div",{className:"input-feedback",children:a.email}),Object(M.jsx)("div",{className:"auth__input",children:Object(M.jsx)("input",{id:"password",type:"password",name:"password",onChange:c,onBlur:s,value:t.password,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",className:a.password&&n.password?"text-input error":"text-input"})}),a.password&&n.password&&Object(M.jsx)("div",{className:"input-feedback",children:a.password}),Object(M.jsxs)("div",{className:"auth__button",children:[!i&&Object(M.jsx)("span",{className:"auth__form-error",children:"\u0424\u043e\u0440\u043c\u0430 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e"}),Object(M.jsx)("button",{onClick:function(){},disabled:l||!(!a.email||!n.email)||!(!a.password||!n.password),children:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"})]})]}),Object(M.jsx)("div",{className:"auth__subtext",children:Object(M.jsx)(P.c,{exact:!0,to:"/signup",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})})]})})]})})})},ae=function(e){var t=e.values,a=e.errors,n=e.touched,c=e.handleChange,s=e.handleBlur,r=e.handleSubmit,i=e.isValid,l=e.isSubmitting;return Object(M.jsx)("div",{className:"auth",children:Object(M.jsx)("div",{className:"container",children:Object(M.jsxs)("div",{className:"auth__row",children:[Object(M.jsxs)("div",{className:"auth__top",children:[Object(M.jsx)("div",{className:"auth__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(M.jsx)("div",{className:"auth__text",children:"\u0414\u043b\u044f \u0432\u0445\u043e\u0434\u0430 \u0432 \u0447\u0430\u0442, \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]}),Object(M.jsx)("form",{onSubmit:r,className:"auth__body",children:Object(M.jsxs)("div",{className:"auth__item",children:[Object(M.jsxs)("div",{className:"auth__functional",children:[Object(M.jsx)("div",{className:"auth__input",children:Object(M.jsx)("input",{id:"email",type:"email",name:"email",onChange:c,onBlur:s,value:t.email,placeholder:"E-mail",className:a.email&&n.email?"text-input error":"text-input"})}),a.email&&n.email&&Object(M.jsx)("div",{className:"input-feedback",children:a.email}),Object(M.jsx)("div",{className:"auth__input",children:Object(M.jsx)("input",{id:"fullname",type:"text",name:"fullname",onChange:c,onBlur:s,value:t.fullname,placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f \u0438 \u0444\u0430\u043c\u0438\u043b\u0438\u044f",className:"text-input"})}),Object(M.jsx)("div",{className:"auth__input",children:Object(M.jsx)("input",{id:"password",type:"password",name:"password",onChange:c,onBlur:s,value:t.password,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",className:a.password&&n.password?"text-input error":"text-input"})}),a.password&&n.password&&Object(M.jsx)("div",{className:"input-feedback",children:a.password}),Object(M.jsx)("div",{className:"auth__input",children:Object(M.jsx)("input",{id:"password_2",type:"password",name:"password_2",onChange:c,onBlur:s,value:t.password_2,placeholder:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",className:a.password_2&&n.password_2?"text-input error":"text-input"})}),a.password_2&&n.password_2&&Object(M.jsx)("div",{className:"input-feedback",children:a.password_2}),Object(M.jsxs)("div",{className:"auth__button",children:[!i&&Object(M.jsx)("span",{className:"auth__form-error",children:"\u0424\u043e\u0440\u043c\u0430 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e"}),Object(M.jsx)("button",{type:"submit",onClick:function(e){},disabled:l||!(!a.email||!n.email)||!(!a.password||!n.password),children:"\u0417\u0410\u0420\u0415\u0413\u0418\u0421\u0422\u0420\u0418\u0420\u041e\u0412\u0410\u0422\u042c\u0421\u042f"})]})]}),Object(M.jsx)("div",{className:"auth__subtext",children:Object(M.jsx)(P.c,{exact:!0,to:"/signin",children:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"})})]})})]})})})},ne=a(47),ce=Object(ne.a)({mapPropsToValues:function(e){return{email:e.initialEmail||"",fullname:e.fullname||"",password:e.initialPassword||"",password_2:e.initialPassword||""}},validate:function(e){var t={};return se({isAuth:!1,values:e,errors:t}),t},handleSubmit:function(e,t){var a=t.setSubmitting,n=t.props;n.fetchUserRegister(e).then((function(e){11e3===e.data.code?alert("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0442\u0430\u043a\u043e\u0439 \u043f\u043e\u0447\u0442\u043e\u0439 \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d"):11e3!==e.data.code&&200===e.status&&n.history.push("/signin"),a(!1)}))},displayName:"RegisterForm"})(ae),se=function(e){var t=e.isAuth,a=e.values,n=e.errors,c={email:function(e){e?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)||(n.email="\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 E-Mail"):n.email="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 E-Mail"},password:function(e){e?t||/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})/.test(e)||(n.password="\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043b\u0435\u0433\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):n.password="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},password_2:function(e){t||e===a.password||(n.password_2="\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442")},fullname:function(e){t||e||(n.fullname="\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0441\u0432\u043e\u0435 \u0438\u043c\u044f \u0438 \u0444\u0430\u043c\u0438\u043b\u0438\u044e")}};Object.keys(a).forEach((function(e){return c[e]&&c[e](a[e])}))},re=Object(ne.a)({enableReinitialize:!0,mapPropsToValues:function(e){return{email:e.initialEmail||"",password:e.initialPassword||""}},validate:function(e){var t={};return se({isAuth:!0,values:e,errors:t}),t},handleSubmit:function(){var e=Object(b.a)(m.a.mark((function e(t,a){var n,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.setSubmitting,(c=a.props).fetchUserLogin(t).then((function(e){e&&"success"===e.status&&c.history.push("/"),n(!1)}));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),displayName:"AuthForm"})(te),ie=function(){return Object(M.jsx)("div",{className:"loader-wrapper",children:Object(M.jsxs)("div",{className:"lds-spinner",children:[Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{}),Object(M.jsx)("div",{})]})})},le=function(e){var t=e.hash,a=e.verified;return t?a?{status:"success",title:"\u0413\u043e\u0442\u043e\u0432\u043e!",message:"\u0410\u043a\u043a\u0430\u0443\u043d\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d!"}:{status:"error",title:"\u041e\u0448\u0438\u0431\u043a\u0430",message:"\u0412\u044b \u0443\u043a\u0430\u0437\u0430\u043b\u0438 \u043d\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0438\u043b\u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0445\u0435\u0448."}:{status:"info",title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u043e\u0447\u0442\u0443",message:"\u0421\u0441\u044b\u043b\u043a\u0430 \u0441 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435\u043c \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0430 \u043d\u0430 E-Mail."}},oe=function(e){var t=e.history,a=location.search.split("hash=")[1],n=Object(l.useState)(!1),c=Object(B.a)(n,2),s=c[0],r=c[1],i=Object(l.useState)(!!a),o=Object(B.a)(i,2),d=o[0],u=o[1],j=Object(l.useState)(le({hash:a,checking:d,verified:s})),h=Object(B.a)(j,2),m=h[0],b=h[1],_=function(e){var t=e.checking,n=e.verified;b(le({hash:a,checking:t,verified:n})),r(n),u(t)};return Object(l.useEffect)((function(){a&&O.a.get("http://localhost:3000/user/verify?hash="+a).then((function(){_({verified:!0,checking:!1})})).catch((function(){_({verified:!1,checking:!1})}))}),[]),Object(M.jsx)(M.Fragment,{children:Object(M.jsx)("div",{className:"auth",children:Object(M.jsx)("div",{className:"container",children:Object(M.jsx)("div",{className:"auth__row",children:d?Object(M.jsx)(ie,{}):Object(M.jsx)("div",{className:"auth__item auth__item--check",children:Object(M.jsxs)("div",{className:"auth__top",children:[Object(M.jsx)("div",{className:"auth__title",children:m.title}),Object(M.jsx)("div",{className:"auth__text",children:m.message}),"success"===m.status&&s&&Object(M.jsx)("div",{className:"auth__button",children:Object(M.jsx)("button",{onClick:function(){return t.push("/signin")},children:"\u0412\u043e\u0439\u0442\u0438"})})]})})})})})})},de=(a(148),a(35)),ue=function(e){var t=e.isMe,a=e.isRead;return t&&(a?Object(M.jsx)("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd",children:Object(M.jsx)("path",{d:"M24 6.278l-11.16 12.722-6.84-6 1.319-1.49 5.341 4.686 9.865-11.196 1.475 1.278zm-22.681 5.232l6.835 6.01-1.314 1.48-6.84-6 1.319-1.49zm9.278.218l5.921-6.728 1.482 1.285-5.921 6.756-1.482-1.313z"})}):Object(M.jsx)("svg",{width:"14",height:"14",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd",children:Object(M.jsx)("path",{d:"M21 6.285l-11.16 12.733-6.84-6.018 1.319-1.49 5.341 4.686 9.865-11.196 1.475 1.285z"})}))||null},je=function(e){var t=e.author;if(t.avatar)return Object(M.jsx)("div",{className:H()("main-column-left__avatar avatar",{"avatar-online":t.isOnline}),children:Object(M.jsx)("img",{src:t.avatar,alt:"avatar"})});var a=_e(t._id),n=a.color,c=a.colorLighten,s=t.fullname[0];return Object(M.jsx)("div",{style:{background:"linear-gradient(135deg, ".concat(n," 0%, ").concat(c," 96.52%)")},className:H()("avatar-char",{"avatar-online":t.isOnline}),children:s})},he=function(e){var t=e.modalActive,a=e.setModalActive,n=e.setMessageText,c=e.messageText,s=Object(l.useState)(""),r=Object(B.a)(s,2),i=r[0],o=r[1],d=Object(l.useState)([]),u=Object(B.a)(d,2),j=u[0],h=u[1],_=Object(l.useState)(!1),p=Object(B.a)(_,2),v=p[0],f=p[1],x=function(){var e=Object(b.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(t.target.value),e.next=3,O.a.get("http://localhost:3000/user/find?query="+i);case 3:a=e.sent,h(a.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(b.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.prev=1,e.next=4,O.a.post("http://localhost:3000/dialogs",{partner:j[0].id,text:c});case 4:t=e.sent,f(!1),h(t.data),a(!1),o(""),n(""),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(1);case 14:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(){return e.apply(this,arguments)}}();return Object(M.jsx)("div",{className:H()("modal",{active:t}),onClick:function(){return a(!1)},children:Object(M.jsx)("div",{className:H()("modal__content",{active:t}),onClick:function(e){return e.stopPropagation()},children:Object(M.jsxs)("div",{className:"modal__wrapper",children:[Object(M.jsxs)("div",{className:"modal__info info-modal",children:[Object(M.jsx)("div",{className:"info-modal__text",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433"}),Object(M.jsx)("div",{onClick:function(){return a(!1)},className:"info-modal__close",children:"X"})]}),Object(M.jsx)("div",{className:"modal__top",children:Object(M.jsxs)("div",{className:"main-column-left__input",children:[Object(M.jsx)("label",{className:"modal__label",children:"Email \u0438\u043b\u0438 \u0438\u043c\u044f:"}),Object(M.jsx)("input",{onChange:x,value:i,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 email \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u0438\u043c\u044f"})]})}),Object(M.jsxs)("div",{className:"modal__middle",children:[Object(M.jsx)("label",{className:"modal__label",children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435:"}),Object(M.jsx)("textarea",{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",onChange:function(e){n(e.target.value)},value:c})]}),Object(M.jsx)("div",{className:"modal__bottom",children:Object(M.jsx)("div",{className:"auth__button",children:Object(M.jsx)("button",{disabled:!c,onClick:g,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433"})})}),Object(M.jsx)("div",{className:"",children:v&&Object(M.jsx)(ie,{})})]})})})},me=a(58),be=a.n(me),_e=function(e){var t=e.substr(0,3).split("").map((function(e){return(t=e.charCodeAt(0))>255?255:t<0?0:t>255?255:t<0?0:t;var t})),a=Object(B.a)(t,3),n=a[0],c=a[1],s=a[2];return{color:be()({r:n,g:c,b:s}).lighten(10).saturate(10).toHexString(),colorLighten:be()({r:n,g:c,b:s}).lighten(30).saturate(30).toHexString()}};var Oe=a(149),pe=a(147);function ve(e){return{time:Object(Oe.a)(new Date(e))?Object(pe.a)(new Date(e),"HH:mm",{locale:de.a}):Object(pe.a)(new Date(e),"dd.MM.yyyy",{locale:de.a})}}var fe=function(){var e=G((function(e){return e.user})).isAuth,t=k(),a=t.fetchUserLogin,n=t.fetchUserRegister,c=t.fetchUserData,s=t.setCurrentDialog,r=Object(o.g)(),i=Object(o.h)();return Object(l.useEffect)((function(){c()}),[]),Object(l.useEffect)((function(){var e=i.pathname.split("/").pop();"/signin"!==i.pathname&&s(e)}),[i.pathname]),Object(M.jsx)(M.Fragment,{children:Object(M.jsxs)(o.d,{children:[Object(M.jsx)(o.b,{exact:!0,path:["/signin","/signup","/signup/verify"],children:Object(M.jsx)(ee,{fetchUserLogin:a,fetchUserRegister:n,history:r})}),Object(M.jsx)(o.b,{path:"/",render:function(){return e?Object(M.jsx)(I,{}):Object(M.jsx)(o.a,{to:"/signin"})}})]})})},xe=a(85),ge={items:[],loading:!1,error:"",currentDialogsId:window.location.pathname.split("dialog/")[1]},Ee=a(86),Se={loading:!1,error:!1,items:[]},Ne={data:null,token:window.localStorage.token,isAuth:!!window.localStorage.token,loading:!1,error:""},we=Object(u.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f.FETCH_MESSAGES_PENDING:return Object(j.a)(Object(j.a)({},e),{},{loading:!0,error:!1});case f.FETCH_MESSAGES_SUCCESS:return Object(j.a)(Object(j.a)({},e),{},{loading:!1,items:t.payload,error:!1});case f.FETCH_MESSAGES_ERROR:return Object(j.a)(Object(j.a)({},e),{},{loading:!1,error:!0});case f.ADD_MESSAGE:return Object(j.a)(Object(j.a)({},e),{},{items:[].concat(Object(Ee.a)(e.items),[t.payload])});default:return e}},dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.FETCH_DIALOGS_PENDING:return Object(j.a)(Object(j.a)({},e),{},{loading:!0});case p.FETCH_DIALOGS_SUCCESS:return Object(j.a)(Object(j.a)({},e),{},{loading:!1,items:t.payload});case p.FETCH_DIALOGS_ERROR:return Object(j.a)(Object(j.a)({},e),{},{loading:!1,error:t.payload});case p.SET_CURRENT_DIALOG:return Object(j.a)(Object(j.a)({},e),{},{loading:!1,currentDialogsId:t.payload});default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E.SET_USER_DATA_PENDING:return Object(j.a)(Object(j.a)({},e),{},{loading:!0});case E.SET_IS_AUTH:return Object(j.a)(Object(j.a)({},e),{},{isAuth:t.payload,loading:!1});case E.SET_USER_DATA_SUCCESS:return Object(j.a)(Object(j.a)({},e),{},{data:t.payload,isAuth:!0,token:window.localStorage.token,loading:!1});case E.SET_USER_DATA_ERROR:return Object(j.a)(Object(j.a)({},e),{},{loading:!1,error:t.payload});default:return e}}}),Ae=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,Re=Object(u.e)(we,Ae(Object(u.a)(xe.a)));i.a.render(Object(M.jsx)(P.a,{children:Object(M.jsx)(d.a,{store:Re,children:Object(M.jsx)(fe,{})})}),document.getElementById("root"))},92:function(e,t,a){}},[[146,1,2]]]);
//# sourceMappingURL=main.e12eb219.chunk.js.map